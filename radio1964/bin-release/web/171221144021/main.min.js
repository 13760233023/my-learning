var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Gift=function(t){function e(e){var i=t.call(this)||this;return i.giftType=e,i.createView(),i.giftImg.touchEnabled=!0,i.giftImg.addEventListener(egret.TouchEvent.TOUCH_TAP,i.choose,i),i}return __extends(e,t),e.prototype.createView=function(){switch(this.hadChoose=!1,this.giftType){case 1:this.giftImg=this.createBitmapByName("gift1_png"),this.giftName="猫王收音机OTR 纯真白";break;case 2:this.giftImg=this.createBitmapByName("gift2_png"),this.giftName="猫王收音机OTR 嬉皮红";break;case 3:this.giftImg=this.createBitmapByName("gift3_png"),this.giftName="猫王收音机OTR 复古绿";break;default:this.giftImg=this.createBitmapByName("gift1_png"),this.giftName="猫王收音机OTR 纯真白"}this.addChild(this.giftImg),this.giftImg.rotation=10},e.prototype.play=function(){this.giftImg.anchorOffsetX=this.giftImg.x+this.giftImg.width/2,this.giftTw=egret.Tween.get(this.giftImg),this.giftTw.to({y:this.giftImg.y+30},1e3),this.giftTw=egret.Tween.get(this.giftImg,{loop:!0}),this.giftTw.to({x:this.giftImg.x+10,rotation:-10},200*Math.random()+400).wait(100).to({x:this.giftImg.x,rotation:10},200*Math.random()+400).wait(100)},e.prototype.choose=function(){this.hadChoose=!0,console.log("choose"+this.giftType),this.giftTw.pause(),this.giftTw=egret.Tween.get(this.giftImg),this.giftTw.to({alpha:0},600).set({alpha:0,visible:!1});var t=new ChooseGiftEvent(ChooseGiftEvent.EventType);t.giftType=this.giftType,this.dispatchEvent(t)},e.prototype.giveback=function(){this.hadChoose&&(this.hadChoose=!1,this.giftImg.visible=!0,this.giftImg.alpha=0,this.giftTw=egret.Tween.get(this.giftImg),this.giftTw.to({alpha:1},600).set({alpha:1,visible:!0}),this.giftTw=egret.Tween.get(this.giftImg,{loop:!0}),this.giftTw.to({x:this.giftImg.x+10,rotation:-10},500).wait(100).to({x:this.giftImg.x,rotation:10},500).wait(100))},e.getGiftName=function(t){switch(t){case 1:return"猫王收音机OTR 纯真白";case 2:return"猫王收音机OTR 嬉皮红";case 3:return"猫王收音机OTR 复古绿";default:return"猫王收音机OTR 纯真白"}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(Gift.prototype,"Gift");var GiftBox=function(t){function e(e,i,o,s){var n=t.call(this)||this;return n.stageW=e,n.stageH=i,n.boxX=o,n.boxY=s,n.createView(),n}return __extends(e,t),e.prototype.createView=function(){this.giftBoxImg=this.createBitmapByName("gift_box_png"),this.addChild(this.giftBoxImg),this.giftBoxImg.x=this.boxX-.08*this.giftBoxImg.width,this.giftBoxImg.y=this.boxY-.7*this.giftBoxImg.height,this.textTip=new egret.TextField,this.textTip.text="挑选礼物放入礼盒",this.textTip.textColor=9772583,this.textTip.size=40,this.textTip.lineSpacing=20,this.addChild(this.textTip),this.textTip.x=(this.stageW-this.textTip.width)/2,this.textTip.y=this.boxY+(this.stageH-this.boxY-this.textTip.height)/2},e.prototype.play=function(){this.giftBoxTw=egret.Tween.get(this.giftBoxImg),this.giftBoxTw.to({y:this.giftBoxImg.y+30},1e3),this.giftBoxTw=egret.Tween.get(this.textTip),this.giftBoxTw.to({y:this.textTip.y+30},1e3)},e.prototype.chooseListener=function(t){this.textTip.text=Gift.getGiftName(t.giftType)+"\n已装入礼物盒",this.textTip.x=(this.stageW-this.textTip.width)/2,this.textTip.y=this.giftBoxImg.y+this.giftBoxImg.height+20,this.textTip.textAlign="center",this.giftBoxTw=egret.Tween.get(this.giftBoxImg),this.giftBoxTw.to({alpha:1},200).wait(100).to({x:this.giftBoxImg.x-10,y:this.giftBoxImg.y-10,width:this.giftBoxImg.width+20,height:this.giftBoxImg.height+20},200).wait(200).to({x:this.giftBoxImg.x,y:this.giftBoxImg.y,width:this.giftBoxImg.width,height:this.giftBoxImg.height},200).wait(100);var e=new ChooseGiftEvent(ChooseGiftEvent.EventType);e.giftType=t.giftType,this.dispatchEvent(e)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(GiftBox.prototype,"GiftBox");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="这礼是猫王加载中..."+t+"/"+e,this.textField.x=(this.width-this.textField.width)/2,this.textField.y=(this.height-this.textField.height)/2},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),this.loadingView.width=this.stage.stageWidth,this.loadingView.height=this.stage.stageHeight,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.bgmPlay=function(){return console.log("bgmPlay"),this.soundChannel?(this.soundChannel.stop(),this.soundChannel=null,void this.bgmTW.pause()):(this.soundChannel=this.bgm.play(),this.bgmTW=egret.Tween.get(this.bgmBtn,{loop:!0}),void this.bgmTW.to({rotation:360},2e3))},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_png");this.addChild(t);var e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var o=667/i;this.snowObj=new Snow(50,e,i),this.addChild(this.snowObj);var s=this.createBitmapByName("christmas_tree_png");this.addChild(s);var n=.72*i,h=n/s.height*s.width;s.height=n,s.width=h,s.x=.5*(e-s.width),s.y=63*o;var r=egret.Tween.get(s);r.to({y:100},1e3);var a=new Gift(2);this.addChild(a),a.x=s.x+s.width/2-30,a.y=s.y+200,a.play();var g=new Gift(1);this.addChild(g),g.x=a.x+a.width,g.y=a.y+250,g.play();var p=new Gift(2);this.addChild(p),p.x=s.x+s.width/2-20,p.y=g.y+100,p.play();var d=new Gift(1);this.addChild(d),d.x=s.x+d.width,d.y=p.y+100,d.play();var f=new Gift(3);this.addChild(f),f.x=a.x+50,f.y=d.y+100,f.play();var c=new GiftBox(e,i,s.x,s.y+s.height);this.addChild(c),c.play(),this.bgmBtn=this.createBitmapByName("music_png"),this.addChild(this.bgmBtn),this.bgmBtn.x=e-this.bgmBtn.width,this.bgmBtn.y=this.bgmBtn.height,this.bgmBtn.anchorOffsetX+=this.bgmBtn.width/2,this.bgmBtn.anchorOffsetY+=this.bgmBtn.height/2,this.bgmBtn.touchEnabled=!0,this.bgmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bgmPlay,this),this.bgm=RES.getRes("bg_mp3"),"ios"!=getDevice()&&this.bgmPlay();var l=new PopBox(e,i);this.addChild(l),l.addEventListener(ChooseGiftEvent.EventType,a.giveback,a),l.addEventListener(ChooseGiftEvent.EventType,g.giveback,g),l.addEventListener(ChooseGiftEvent.EventType,p.giveback,p),l.addEventListener(ChooseGiftEvent.EventType,d.giveback,d),l.addEventListener(ChooseGiftEvent.EventType,f.giveback,f),a.addEventListener(ChooseGiftEvent.EventType,c.chooseListener,c),g.addEventListener(ChooseGiftEvent.EventType,c.chooseListener,c),p.addEventListener(ChooseGiftEvent.EventType,c.chooseListener,c),d.addEventListener(ChooseGiftEvent.EventType,c.chooseListener,c),f.addEventListener(ChooseGiftEvent.EventType,c.chooseListener,c),c.addEventListener(ChooseGiftEvent.EventType,l.openListener,l),this.timer=new egret.Timer(50,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.start()},e.prototype.timerFunc=function(t){this.snowObj.play()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var PopBox=function(t){function e(e,i){var o=t.call(this)||this;return o.bg=new egret.Shape,o.addChild(o.bg),o.bg.width=e,o.bg.height=i,o.bg.x=0,o.bg.y=0,o.bg.graphics.beginFill(14932669,0),o.bg.graphics.drawRect(0,0,o.bg.width,o.bg.height),o.bg.graphics.endFill(),o.bg.touchEnabled=!0,o.bg.alpha=0,o.bg.visible=!1,o.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,o.closeAnim,o),o.popBg=o.createBitmapByName("popbox_png"),o.addChild(o.popBg),o.popBg.x=(e-o.popBg.width)/2,o.popBg.y=(i-o.popBg.height)/2,o.popBg.touchEnabled=!0,o.popBg.addEventListener(egret.TouchEvent.TOUCH_TAP,o.gotoUrl,o),o.popBg.alpha=0,o.popBg.visible=!1,o}return __extends(e,t),e.prototype.openAnim=function(){this.bg.visible=!0,this.popBg.visible=!0,this.bgTw=egret.Tween.get(this.bg),this.bgTw.to({alpha:1},300).set({alpha:1}),this.popBgTw=egret.Tween.get(this.popBg),this.popBgTw.to({alpha:1},500).set({alpha:1})},e.prototype.closeAnim=function(){this.bgTw=egret.Tween.get(this.bg),this.bgTw.to({alpha:0,visible:!1},300),this.popBgTw=egret.Tween.get(this.popBg),this.popBgTw.to({alpha:0,visible:!1},300).set({alpha:1});var t=new ChooseGiftEvent(ChooseGiftEvent.EventType);t.giftType=this.giftType,this.dispatchEvent(t)},e.prototype.gotoUrl=function(){openUrl(this.giftType)},e.prototype.openListener=function(t){this.giftType=t.giftType,this.openAnim()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(PopBox.prototype,"PopBox");var Snow=function(t){function e(e,i,o){var s=t.call(this)||this;s.num=e,s.screenW=i,s.screenH=o,s.snowPoint=new Array,s.vX=new Array,s.vY=new Array,s.size=new Array,s.windDirection=new Array;for(var n=0;n<s.num;n++)s.size[n]=.4+2*Math.random(),s.snowPoint[n]=s.createBitmapByName("snow_png"),s.addChild(s.snowPoint[n]),s.snowPoint[n].x=Math.random()*s.screenW+1,s.snowPoint[n].y=Math.random()*s.screenH,s.snowPoint[n].scaleX*=s.size[n],s.snowPoint[n].scaleY*=s.size[n],s.vX[n]=1+Math.floor(1*Math.random()),s.vY[n]=2+Math.floor(5*Math.random()),s.windDirection[n]=2*Math.random()==0?-1:1;return s}return __extends(e,t),e.prototype.play=function(){for(var t=0;t<this.num;t++)this.snowPoint[t].y<this.screenH+5&&this.snowPoint[t].x<this.screenW+5?(this.snowPoint[t].x+=this.vX[t],this.snowPoint[t].y+=this.vY[t]):(this.snowPoint[t]=this.createBitmapByName("snow_png"),this.addChild(this.snowPoint[t]),this.snowPoint[t].x=Math.random()*this.screenW+1,this.snowPoint[t].y=-this.snowPoint[t].height,this.snowPoint[t].scaleX*=this.size[t],this.snowPoint[t].scaleY*=this.size[t],this.vX[t]=1+Math.floor(1*Math.random()),this.vY[t]=2+Math.floor(5*Math.random()),this.windDirection[t]=2*Math.random()==0?-1:1)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(Snow.prototype,"Snow");var ChooseGiftEvent=function(t){function e(e,i,o){return void 0===i&&(i=!1),void 0===o&&(o=!1),t.call(this,e,i,o)||this}return __extends(e,t),e.EventType="ChooseGiftEvent",e}(egret.Event);__reflect(ChooseGiftEvent.prototype,"ChooseGiftEvent");