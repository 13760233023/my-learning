var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Gift=function(t){function e(e){var i=t.call(this)||this;return i.giftType=e,i.createView(),i.giftImg.touchEnabled=!0,i.giftImg.addEventListener(egret.TouchEvent.TOUCH_TAP,i.choose,i),i}return __extends(e,t),e.prototype.createView=function(){switch(this.hadChoose=!1,this.giftType){case 1:this.giftImg=this.createBitmapByName("gift1_png"),this.giftName="猫王收音机OTR 纯真白";break;case 2:this.giftImg=this.createBitmapByName("gift2_png"),this.giftName="猫王收音机OTR 嬉皮红";break;case 3:this.giftImg=this.createBitmapByName("gift3_png"),this.giftName="猫王收音机OTR 复古绿";break;default:this.giftImg=this.createBitmapByName("gift1_png"),this.giftName="猫王收音机OTR 纯真白"}this.addChild(this.giftImg),this.giftImg.rotation=10},e.prototype.play=function(){this.giftImg.anchorOffsetX=this.giftImg.x+this.giftImg.width/2,this.giftTw=egret.Tween.get(this.giftImg),this.giftTw.to({y:this.giftImg.y+30},1e3),this.giftTw=egret.Tween.get(this.giftImg,{loop:!0}),this.giftTw.to({x:this.giftImg.x+10,rotation:-10},200*Math.random()+400).wait(100).to({x:this.giftImg.x,rotation:10},200*Math.random()+400).wait(100)},e.prototype.choose=function(){this.hadChoose=!0,console.log("choose"+this.giftType),this.giftTw.pause(),this.giftTw=egret.Tween.get(this.giftImg),this.giftTw.to({alpha:0},600).set({alpha:0,visible:!1});var t=new ChooseGiftEvent(ChooseGiftEvent.EventType);t.giftType=this.giftType,this.dispatchEvent(t)},e.prototype.giveback=function(){this.hadChoose&&(this.hadChoose=!1,this.giftImg.visible=!0,this.giftImg.alpha=0,this.giftTw=egret.Tween.get(this.giftImg),this.giftTw.to({alpha:1},600).set({alpha:1,visible:!0}),this.giftTw=egret.Tween.get(this.giftImg,{loop:!0}),this.giftTw.to({x:this.giftImg.x+10,rotation:-10},500).wait(100).to({x:this.giftImg.x,rotation:10},500).wait(100))},e.getGiftName=function(t){switch(t){case 1:return"猫王收音机OTR 纯真白";case 2:return"猫王收音机OTR 嬉皮红";case 3:return"猫王收音机OTR 复古绿";default:return"猫王收音机OTR 纯真白"}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(Gift.prototype,"Gift");var GiftBox=function(t){function e(e,i,o,n){var s=t.call(this)||this;return s.stageW=e,s.stageH=i,s.boxX=o,s.boxY=n,s.createView(),s}return __extends(e,t),e.prototype.createView=function(){this.giftBoxImg=this.createBitmapByName("gift_box_png"),this.addChild(this.giftBoxImg),this.giftBoxImg.x=this.boxX-.08*this.giftBoxImg.width,this.giftBoxImg.y=this.boxY-.7*this.giftBoxImg.height,this.textTip=new egret.TextField,this.textTip.text="挑选礼物放入礼盒",this.textTip.textColor=9772583,this.textTip.size=40,this.textTip.lineSpacing=20,this.addChild(this.textTip),this.textTip.x=(this.stageW-this.textTip.width)/2,this.textTip.y=this.boxY+(this.stageH-this.boxY-this.textTip.height)/2},e.prototype.play=function(){this.giftBoxTw=egret.Tween.get(this.giftBoxImg),this.giftBoxTw.to({y:this.giftBoxImg.y+30},1e3),this.giftBoxTw=egret.Tween.get(this.textTip),this.giftBoxTw.to({y:this.textTip.y+30},1e3)},e.prototype.chooseListener=function(t){this.textTip.text=Gift.getGiftName(t.giftType)+"\n已装入礼物盒",this.textTip.x=(this.stageW-this.textTip.width)/2,this.textTip.y=this.giftBoxImg.y+this.giftBoxImg.height+20,this.textTip.textAlign="center",this.giftBoxTw=egret.Tween.get(this.giftBoxImg),this.giftBoxTw.to({alpha:1},200).wait(100).to({x:this.giftBoxImg.x-10,y:this.giftBoxImg.y-10,width:this.giftBoxImg.width+20,height:this.giftBoxImg.height+20},200).wait(200).to({x:this.giftBoxImg.x,y:this.giftBoxImg.y,width:this.giftBoxImg.width,height:this.giftBoxImg.height},200).wait(100);var e=new ChooseGiftEvent(ChooseGiftEvent.EventType);e.giftType=t.giftType,this.dispatchEvent(e)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(GiftBox.prototype,"GiftBox");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="这礼是猫王加载中..."+t+"/"+e,this.textField.x=(this.width-this.textField.width)/2,this.textField.y=(this.height-this.textField.height)/2},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),this.loadingView.width=this.stage.stageWidth,this.loadingView.height=this.stage.stageHeight,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=RES.getRes("bg_mp3");t.play();var e=this.createBitmapByName("bg_png");this.addChild(e);var i=this.stage.stageWidth,o=this.stage.stageHeight;e.width=i,e.height=o;var n=667/o;this.snowObj=new Snow(50,i,o),this.addChild(this.snowObj);var s=this.createBitmapByName("christmas_tree_png");this.addChild(s);var h=.72*o,r=h/s.height*s.width;s.height=h,s.width=r,s.x=.5*(i-s.width),s.y=63*n;var a=egret.Tween.get(s);a.to({y:100},1e3);var g=new Gift(2);this.addChild(g),g.x=s.x+s.width/2-30,g.y=s.y+200,g.play();var p=new Gift(1);this.addChild(p),p.x=g.x+g.width,p.y=g.y+200,p.play();var d=new Gift(2);this.addChild(d),d.x=s.x+s.width/2-20,d.y=p.y+100,d.play();var l=new Gift(1);this.addChild(l),l.x=s.x+l.width,l.y=d.y+100,l.play();var c=new Gift(3);this.addChild(c),c.x=g.x+50,c.y=l.y+100,c.play();var f=new GiftBox(i,o,s.x,s.y+s.height);this.addChild(f),f.play();var w=new PopBox(i,o);this.addChild(w),w.addEventListener(ChooseGiftEvent.EventType,g.giveback,g),w.addEventListener(ChooseGiftEvent.EventType,p.giveback,p),w.addEventListener(ChooseGiftEvent.EventType,d.giveback,d),w.addEventListener(ChooseGiftEvent.EventType,l.giveback,l),w.addEventListener(ChooseGiftEvent.EventType,c.giveback,c),g.addEventListener(ChooseGiftEvent.EventType,f.chooseListener,f),p.addEventListener(ChooseGiftEvent.EventType,f.chooseListener,f),d.addEventListener(ChooseGiftEvent.EventType,f.chooseListener,f),l.addEventListener(ChooseGiftEvent.EventType,f.chooseListener,f),c.addEventListener(ChooseGiftEvent.EventType,f.chooseListener,f),f.addEventListener(ChooseGiftEvent.EventType,w.openListener,w),this.timer=new egret.Timer(50,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.start()},e.prototype.timerFunc=function(t){this.snowObj.play()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var PopBox=function(t){function e(e,i){var o=t.call(this)||this;return o.bg=new egret.Shape,o.addChild(o.bg),o.bg.width=e,o.bg.height=i,o.bg.x=0,o.bg.y=0,o.bg.alpha=0,o.bg.graphics.beginFill(14932669,.7),o.bg.graphics.drawRect(0,0,o.bg.width,o.bg.height),o.bg.graphics.endFill(),o.bg.touchEnabled=!0,o.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,o.closeAnim,o),o.boxBg=new egret.Shape,o.addChild(o.boxBg),o.boxBg.width=.8*e,o.boxBg.height=200,o.boxBg.x=.1*e,o.boxBg.y=-o.boxBg.height,o.boxBg.alpha=0,o.boxBg.graphics.lineStyle(10,10170928),o.boxBg.graphics.beginFill(14932669,1),o.boxBg.graphics.drawRect(0,0,o.boxBg.width,o.boxBg.height),o.boxBg.graphics.endFill(),o.boxBg.touchEnabled=!0,o.boxBg.addEventListener(egret.TouchEvent.TOUCH_TAP,o.gotoUrl,o),o.label=new egret.TextField,o.label.text="圣诞老人在遥远的芬兰，\n赶快邀请好友帮你传递心愿，\n就有机会获得猫王的圣诞礼物哦。",o.label.textAlign="center",o.label.size=36,o.label.textColor=10170928,o.addChild(o.label),o.label.lineSpacing=18,o.label.x=(e-o.label.width)/2,o.label.y=(i-o.label.height)/2,o.label.alpha=0,o}return __extends(e,t),e.prototype.openAnim=function(){this.bgTw=egret.Tween.get(this.bg),this.bgTw.to({y:0},300),this.labelTw=egret.Tween.get(this.label),this.labelTw.to({y:(this.bg.height-this.label.height)/2,alpha:1},1e3),this.boxTw=egret.Tween.get(this.boxBg),this.labelTw.to({y:(this.bg.height-this.boxBg.height)/2,alpha:1},1e3)},e.prototype.closeAnim=function(){this.bgTw=egret.Tween.get(this.bg),this.bgTw.to({y:-this.bg.height},300),this.labelTw=egret.Tween.get(this.label),this.labelTw.to({y:-this.label.height,alpha:0},300),this.boxTw=egret.Tween.get(this.boxBg),this.labelTw.to({y:-this.boxBg.height,alpha:0},1e3);var t=new ChooseGiftEvent(ChooseGiftEvent.EventType);t.giftType=this.giftType,this.dispatchEvent(t)},e.prototype.gotoUrl=function(){this.closeAnim()},e.prototype.openListener=function(t){this.giftType=t.giftType,this.openAnim()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(PopBox.prototype,"PopBox");var Snow=function(t){function e(e,i,o){var n=t.call(this)||this;n.num=e,n.screenW=i,n.screenH=o,n.snowPoint=new Array,n.vX=new Array,n.vY=new Array,n.size=new Array,n.windDirection=new Array;for(var s=0;s<n.num;s++)n.size[s]=.4+2*Math.random(),n.snowPoint[s]=n.createBitmapByName("snow_png"),n.addChild(n.snowPoint[s]),n.snowPoint[s].x=Math.random()*n.screenW+1,n.snowPoint[s].y=Math.random()*n.screenH,n.snowPoint[s].scaleX*=n.size[s],n.snowPoint[s].scaleY*=n.size[s],n.vX[s]=1+Math.floor(1*Math.random()),n.vY[s]=2+Math.floor(5*Math.random()),n.windDirection[s]=2*Math.random()==0?-1:1;return n}return __extends(e,t),e.prototype.play=function(){for(var t=0;t<this.num;t++)this.snowPoint[t].y<this.screenH+5&&this.snowPoint[t].x<this.screenW+5?(this.snowPoint[t].x+=this.vX[t],this.snowPoint[t].y+=this.vY[t]):(this.snowPoint[t]=this.createBitmapByName("snow_png"),this.addChild(this.snowPoint[t]),this.snowPoint[t].x=Math.random()*this.screenW+1,this.snowPoint[t].y=-this.snowPoint[t].height,this.snowPoint[t].scaleX*=this.size[t],this.snowPoint[t].scaleY*=this.size[t],this.vX[t]=1+Math.floor(1*Math.random()),this.vY[t]=2+Math.floor(5*Math.random()),this.windDirection[t]=2*Math.random()==0?-1:1)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(Snow.prototype,"Snow");var ChooseGiftEvent=function(t){function e(e,i,o){return void 0===i&&(i=!1),void 0===o&&(o=!1),t.call(this,e,i,o)||this}return __extends(e,t),e.EventType="ChooseGiftEvent",e}(egret.Event);__reflect(ChooseGiftEvent.prototype,"ChooseGiftEvent");